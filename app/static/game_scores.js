// Generated by LiveScript 1.5.0
octavia.register('game_scores', function(){
  var users, res$, i$, x$, ref$, len$, scores, averages, ref1$, studentId, value, date, student, key$, username, values, data, averageData, this$ = this;
  res$ = {};
  for (i$ = 0, len$ = (ref$ = jsDataUsers).length; i$ < len$; ++i$) {
    x$ = ref$[i$];
    res$[x$.pk] = x$.fields;
  }
  users = res$;
  console.log(users);
  scores = {};
  averages = [];
  for (i$ = 0, len$ = (ref$ = jsDataScores).length; i$ < len$; ++i$) {
    ref1$ = ref$[i$].fields, studentId = ref1$.student, value = ref1$.value, date = ref1$.date;
    student = users[studentId];
    (scores[key$ = student.username] || (scores[key$] = [])).push([new Date(date).valueOf(), value]);
  }
  for (username in scores) {
    values = scores[username];
    averages.push([username, avg(map(fn$, values))]);
  }
  res$ = [];
  for (username in scores) {
    values = scores[username];
    res$.push({
      name: username,
      data: sortBy(fn1$, values)
    });
  }
  data = res$;
  averageData = sortBy(function(it){
    return it[1];
  }, averages);
  Highcharts.chart('stats_base', {
    title: {
      text: 'Statistiques'
    },
    xAxis: {
      type: 'datetime'
    },
    yAxis: {
      title: {
        text: 'Score'
      }
    },
    series: data
  });
  Highcharts.chart('stats_avg', {
    chart: {
      type: 'column'
    },
    title: {
      text: 'Moyennes'
    },
    xAxis: {
      type: 'category'
    },
    series: [{
      name: 'Moyennes',
      data: averageData
    }]
  });
  function fn$(it){
    return it[1];
  }
  function fn1$(it){
    return it[0];
  }
});